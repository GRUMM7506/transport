<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Транспорт Душанбе</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <!-- Боковая панель с поиском -->
        <aside class="sidebar">
            <div class="search-panel">
                <h2 class="sidebar-title">Поиск остановки</h2>
                <div class="search-box">
                    <input type="text" id="searchInput" placeholder="Введите название остановки..." autocomplete="off">
                </div>
                <div class="search-filters">
                    <button class="filter-btn active" data-type="all">Все</button>
                    <button class="filter-btn" data-type="bus">Автобус</button>
                    <button class="filter-btn" data-type="minibus">Маршрутка</button>
                </div>
            </div>
            
            <div class="search-results" id="searchResults">
                <div class="empty-state">
                    <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
                        <circle cx="32" cy="32" r="30" stroke="#ddd" stroke-width="2"/>
                        <path d="M32 20v24M20 32h24" stroke="#ddd" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                    <p>Начните вводить название остановки</p>
                </div>
            </div>

            <!-- <div class="route-planner" id="routePlanner" style="display: none;">
                <div class="planner-header">
                    <h3>Построить маршрут</h3>
                    <button class="close-btn" onclick="closePlanner()">×</button>
                </div>
                <div class="planner-inputs">
                    <input type="text" id="fromInput" placeholder="Откуда">
                    <button class="swap-btn" onclick="swapPoints()">⇅</button>
                    <input type="text" id="toInput" placeholder="Куда">
                </div>
                <button class="build-route-btn" onclick="buildRoute()">Построить</button>
            </div> -->
        </aside>

        <!-- Основная область с картой -->
        <main class="map-container">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Загрузка схемы транспорта...</p>
            </div>

            <svg id="transportMap" class="transport-map"></svg>
            
            <!-- Контролы масштабирования -->
            <div class="controls">
                <!-- КНОПКА СМЕНЫ ТЕМЫ -->
                <button class="control-btn" onclick="toggleTheme()" title="Сменить тему">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor" id="themeIcon">
                        <path d="M10 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16zm0 14V4a6 6 0 1 1 0 12z"/>
                    </svg>
                </button>

                <!-- Кнопка настроек
                <button class="control-btn" onclick="openSettings()" title="Настройки">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm7-3a7.97 7.97 0 0 1-.9 3.8l2.1 1.6-1.5 2.6-2.5-1a7.97 7.97 0 0 1-3.4 1.2v2.5h-3v-2.5a7.97 7.97 0 0 1-3.4-1.2l-2.5 1-1.5-2.6 2.1-1.6A7.97 7.97 0 0 1 3 10c0-.9.15-1.8.4-2.6L1.3 6.8l1.5-2.6 2.5 1c.8-.7 1.8-1.2 2.9-1.4V2h3v2.5c1 .2 2 .7 2.9 1.4l2.5-1 1.5 2.6-2.1 1.6c.25.8.4 1.7.4 2.6z"/>
                    </svg> -->
                
                <button class="control-btn" onclick="zoomIn()" title="Приблизить">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 4v12M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <button class="control-btn" onclick="zoomOut()" title="Отдалить">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M4 10h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <!-- <button class="control-btn" onclick="resetView()" title="Сброс">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74-2.74L3 12" />
                    </svg>
                </button> -->
                <button class="control-btn" onclick="resetView()" title="Сбросить">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="10" cy="10" r="2" fill="currentColor"/>
                    </svg>
                </button>
                <button class="control-btn" onclick="togglePlanner()" title="Построить маршрут">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <circle cx="5" cy="5" r="3" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="15" cy="15" r="3" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M7 7l6 6" stroke="currentColor" stroke-width="2"/>
                    </svg>
                </button>
                <button class="control-btn" onclick="openSettings()" title="Настройки">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="2"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                </button>
            </div>
            
            <div id="settingsModal" class="modal-overlay" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:2000; align-items:center; justify-content:center;">
                <div class="modal-content" style="background:white; padding:20px; border-radius:12px; width:80%; max-width:300px;">
                    <h3>Настройки</h3>
                    <label>Размер остановок: <span id="lblRadius"></span></label>
                    <input type="range" id="inpRadius" min="1" max="10" step="0.5" style="width:100%">
                    <br><br>
                    <label>Макс. Зум: <span id="lblZoom"></span></label>
                    <input type="range" id="inpZoom" min="5" max="30" step="1" style="width:100%">
                    <br><br>
                    <label>Детализация путей: <span id="lblPathSimplification"></span></label>
                    <input type="range" id="inpPathSimplification" min="0" max="10" step="1" style="width:100%">
                    <br><br>
                    <label>Разрешение карты: <span id="lblResolution"></span></label>
                    <input type="range" id="inpResolution" min="100" max="1200" step="50" style="width:100%">
                    <br><br>
                    <button onclick="applySettings()" style="width:100%; padding:10px; background:#4CAF50; color:white; border:none; border-radius:5px;">Применить</button>
                    <button onclick="document.getElementById('settingsModal').style.display='none'" style="width:100%; margin-top:10px; padding:10px;">Закрыть</button>
                </div>
            </div>

            <!-- Легенда маршрутов -->
            <div class="legend" id="legend">
                <div class="legend-header">
                    <h4>Маршруты</h4>
                    <button class="legend-toggle" onclick="toggleLegend()">−</button>
                </div>
                <div class="legend-content" id="legendContent">
                    <div class="legend-loading">Загрузка...</div>
                </div>
            </div>

            <!-- Информационная панель -->
            <div class="info-panel" id="infoPanel" style="z-index: 9999;">
                <button class="info-close" onclick="closeInfo()">×</button>
                <h3 id="infoTitle"></h3>
                <div id="infoContent"></div>
            </div>
        </main>
        
        <div class="route-planner" id="routePlanner" style="display: none;">
        <div class="planner-header">
            <h3>Построить маршрут</h3>
            <button class="close-btn" onclick="closePlanner()">×</button>
        </div>
        <div class="planner-inputs">
            <input type="text" id="fromInput" placeholder="Откуда">
            <button class="swap-btn" onclick="swapPoints()">⇅</button>
            <input type="text" id="toInput" placeholder="Куда">
        </div>
        <button class="build-route-btn" onclick="buildRoute()">Построить</button>
    </div>
    </div>

    <!-- Подключаем скрипты -->
    <script src="js/config.js"></script>
    <script src="js/data.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/map.js"></script>
    <script src="js/search.js"></script>
    <script src="js/router.js"></script>
    <script src="js/app.js"></script>
</body>
</html>